<html>
	<head>
		<title>Distance/Time To Action</title>
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
		<script type="text/javascript">
		Number.prototype.toRad = function() {
			return this * Math.PI / 180;
		}

		function postMessage(msg) {
			document.getElementById("message").innerHTML = msg;
		}

		function getLocation(index) {
			postMessage('debug: getlocation' + index);
			if (index && navigator.geolocation) {
				currentIndex = index;
				navigator.geolocation.getCurrentPosition(showPosition);
			} else {
				document.getElementById("message").innerHTML = "Geolocation is not supported by your browser";
			}
		}

		function showPosition(position) {
			postMessage(position.coords.latitude + "," + position.coords.longitude);

			var loc = $("#location"+currentIndex+"-coordinates span")[0];
			loc.innerHTML = position.coords.latitude + ", " + position.coords.longitude;

			var ts = $("#location"+currentIndex+"-timestamp span")[0];
			var timestamp = new Date();
			ts.innerHTML = timestamp.getTime();

			locations[currentIndex] = [position, timestamp];
		}

		function calculateDistance(pos1, pos2) {
			var R = 6371; //km
			var dLat = (pos2.coords.latitude - pos1.coords.latitude).toRad();
			var dLng = (pos2.coords.longitude - pos1.coords.longitude).toRad();
			var lat1 = pos1.coords.latitude.toRad();
			var lat2 = pos2.coords.latitude.toRad();

			var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
			return R * c;
		}


		var currentIndex = 0;
		var locations = [];


		</script>

	</head>
	<body>
		<h1>Location/Time to Action</h1>
		<div id="message"></div>
		<div>
			<h2>Location 1</h2>
			<input type="button" id="btn-location1" onClick="javascript:getLocation(1)" text="Get Location">
			<div id="location1">
				<div id="location1-coordinates" class="coordinates">Location: <span></span></div>
				<div id="location1-timestamp" class="timestamp">Timestamp: <span></span></div>
			</div>
		</div>
		<div>
			<h2>Location 2</h2>
			<input type="button" id="btn-location1" onClick="javascript:getLocation(2)" text="Get Location">
			<div id="location2">
				<div id="location2-coordinates" class="coordinates">Location: <span></span></div>
				<div id="location2-timestamp" class="timestamp">Timestamp: <span></span></div>
			</div>
		</div>
		<div>
			<h2>Speed</h2>
		</div>
		<div>
			<h2>Calculate Time to Action</h2>
		</div>
	</body>
</html>
